# Устранение ошибки 502 Bad Gateway на Render.com

## Причины ошибки 502

Ошибка 502 Bad Gateway означает, что приложение не запустилось или упало сразу после старта.

## Шаги для диагностики и исправления

### 1. Проверьте логи деплоя

1. Зайдите в панель Render.com
2. Выберите ваш сервис `vk-bouwmaster`
3. Перейдите на вкладку **Logs**
4. Проверьте последние логи на наличие ошибок

### 2. Проверьте переменные окружения

В настройках сервиса (Settings → Environment) должны быть установлены:

- `NODE_ENV` = `production` (уже есть в render.yaml)
- `OPENAI_API_KEY` = ваш ключ от OpenAI (добавьте вручную через веб-интерфейс)

**ВАЖНО:** `OPENAI_API_KEY` нужно добавить вручную через веб-интерфейс Render, так как секретные ключи не должны быть в `render.yaml`.

### 3. Проверьте команду запуска

В `package.json` команда запуска:
```json
"start": "next start -p ${PORT:-3000}"
```

Render автоматически устанавливает переменную `PORT`, поэтому это должно работать.

### 4. Проверьте наличие Render Disk (опционально)

Если вы используете загрузку файлов:
1. Settings → Disk → Create Disk
2. Mount path: `/uploads`
3. Это нужно для сохранения данных между перезапусками

### 5. Перезапустите сервис

1. В панели Render нажмите **Manual Deploy** → **Deploy latest commit**
2. Или просто перезапустите сервис через кнопку **Restart**

### 6. Проверьте health check

Health check настроен на путь `/`. Убедитесь, что главная страница доступна.

## Частые проблемы

### Проблема: Приложение падает при старте из-за отсутствия файлов данных

**Решение:** При первом запуске приложение автоматически создаст необходимые файлы из fallback-файлов в репозитории.

### Проблема: Ошибка "Cannot find module"

**Решение:** 
1. Убедитесь, что `buildCommand` выполняется успешно
2. Проверьте, что все зависимости установлены (`npm install`)

### Проблема: Порт уже занят

**Решение:** Render автоматически устанавливает переменную `PORT`, убедитесь, что команда запуска использует `${PORT}`.

## Проверка работоспособности

После успешного деплоя:

1. Откройте `https://vkbouwmaster.com` - должна загрузиться главная страница
2. Проверьте API: `https://vkbouwmaster.com/api/works` - должен вернуть JSON с работами
3. Запустите переводы: `https://vkbouwmaster.com/api/works/translate?force=true` - должен начать перевод всех работ

## Контакты для поддержки

Если проблема не решается:
1. Проверьте логи в Render Dashboard
2. Проверьте статус сервиса в Render Dashboard
3. Убедитесь, что все переменные окружения установлены

